---
version: 2
plan:
  key: VFS-PROV
plan-permissions:
  - users:
      - plgdutka
    groups:
      - plggveildev
    permissions:
      - view
      - edit
      - build
      - clone
      - admin
---
version: 2
plan:
  project-key: VFS
  key: PROV
  name: op-worker
variables:
  coverOptionOverride: develop_only
  version_major: '2'
  version_minor: '1'
  planSrc: VFS-PROV
  branchSrc: release/20.02.19
repositories:
  - op-worker:
      scope: global
branches:
  create: for-new-branch
  delete:
    after-deleted-days: 0
    after-inactive-days: 30
  link-to-jira: true
notifications: [ ]
labels: [ ]
dependencies:
  require-all-stages-passing: false
  enabled-for-branches: true
  block-strategy: none
  plans: [ ]
other:
  concurrent-build-plugin: system-default
  all-other-apps:
    custom:
      com.atlassian.bamboo.plugin.hungbuildkiller.stopped.enabled: 'true'
      buildExpiryConfig:
        period: weeks
        expiryTypeBuildLog: 'false'
        enabled: 'true'
        expiryTypeArtifact: 'true'
        duration: '1'
        buildsToKeep: '1'
stages:
  - Qnthack - copy quarantine:
      manual: false
      final: false
      jobs:
        - Qnthack - copy quarantine
        - Qnthack - terminate build
  - Build:
      manual: false
      final: false
      jobs:
        - Build
  - Test:
      manual: false
      final: false
      jobs:
        - _Dialyze
        - _Codetag Tracker
        - _Unit Test
        - api_file_attrs
        - api_file_crud
        - api_file_ls
        - api_file_metadata_delete
        - api_file_metadata_get
        - api_file_metadata_set
        - api_file_stream
        - api_file_upload
        - api_share
        - autocleaning
        - cdmi
        - ceph_helper
        - cephrados_helper
        - client_events
        - cluster_upgrade
        - connection
        - connection_layer
        - connection_manager
        - datastore_remote_driver
        - dbsync
        - dbsync_changes_requesting
        - dbsync_changes_requesting_with_errors
        - event_manager
        - event_stream
        - events
        - events_performance
        - events_reliability
        - events_reliability_2op
        - file_deletion
        - file_lifecycle
        - file_links_reconciliation_traverse
        - file_popularity
        - file_registration
        - fslogic_req
        - glusterfs_helper
        - gs_channel
        - gs_cluster_logic
        - gs_group_logic
        - gs_handle_logic
        - gs_handle_service_logic
        - gs_harvester_logic
        - gs_provider_logic
        - gs_share_logic
        - gs_space_logic
        - gs_storage_logic
        - gs_token_logic
        - gs_user_logic
        - gs_zone_connection
        - harvesting
        - harvesting_stream
        - idp_access_token
        - lfm_attrs
        - lfm_files_posix
        - lfm_files_s3
        - luma
        - massive_multi_provider_file_ops
        - massive_multi_provider_file_ops2
        - memory_pools_cleanup
        - model_file_meta
        - monitoring
        - multi_provider_cdmi
        - multi_provider_changes_rest
        - multi_provider_db_sync
        - multi_provider_file_ops
        - multi_provider_proxy
        - multi_provider_qos
        - multi_provider_rest
        - multi_provider_view_rest
        - node_failure
        - nulldevice_helper
        - performance_2_provider
        - permissions_posix
        - permissions_s3
        - posix_helper
        - provider_connection
        - qos
        - qos_api
        - qos_replica_protection
        - quota
        - readonly_storage
        - rename
        - replica_deletion
        - replica_eviction_transfers_rest
        - replica_migration_transfers_rest
        - replication
        - replication_transfers_rest
        - rest
        - reverse_luma
        - s3_helper
        - sequencer
        - sequencer_in_stream
        - sequencer_manager
        - sequencer_out_stream
        - sequencer_performance
        - session_manager
        - session_offline
        - session_watcher
        - single_node_failure
        - space_unsupport
        - storage_cleanup
        - storage_files
        - storage_import
        - storage_import_deletion
        - storage_import_s3
        - storage_req
        - storage_sync_links
        - storage_traverse
        - swift_helper
        - tmp_db_error
        - transfer_create_api
        - transfer_get_api
        - transfer_stats
        - transfers_restart
        - trash
        - tree_deletion_traverse
        - user_auth
        - view
        - webdav_helper
        - webdav_token
        - xrootd_helper
  - Coverage report:
      manual: false
      final: false
      jobs:
        - Coverage report
  - Qnthack - rerun:
      manual: false
      final: true
      jobs:
        - Qnthack - rerun

Qnthack - copy quarantine:
  key: COPQU
  other: &common-opts
    clean-working-dir: true
    all-other-apps:
      custom:
        auto: { }
        buildHangingConfig.enabled: 'false'
  tasks:
    - checkout: &fake-checkout
        conditions:
          - variable:
              exists: fake.var
    - script: &quarantine-hack-run-script-on-third-build
        interpreter: BINSH_OR_CMDEXE
        scripts:
          - |-
            # The script which copies the quarantined test cases resides on the bamboo server.
            # For more details about the script look at https://git.onedata.org/projects/VFS/repos/bamboos/browse/bamboo-server/quarantine-copy.sh?at=refs%2Fheads%2Ffeature%2FVFS-9519-auto-quarantine-test-cases-for-new-branches
            # The script is run indirectly by the CGI script used in the curl command.
            echo curl 10.87.23.72:3080/cgi-bin/quarantine-copy?${bamboo_planSrc}+${bamboo_planKey}
            curl 10.87.23.72:3080/cgi-bin/quarantine-copy?${bamboo_planSrc}+${bamboo_planKey}
        description: Copy quarantined test cases
        conditions: &quarantine-hack-cond-build3
          - variable:
              matches:
                bamboo.buildNumber: '3'
    - script: &always-successful
        interpreter: BINSH_OR_CMDEXE
        description: Always successful
        scripts:
          - true

Qnthack - terminate build:
  key: TERMB
  other: *common-opts
  tasks:
    - checkout: *fake-checkout
    - script: *always-successful
    - script:
        <<: *quarantine-hack-run-script-on-third-build
        scripts:
          - |-
            echo Terminating build...
            false
        description: Terminate build
        conditions: *quarantine-hack-cond-build3

Build:
  key: BUILD
  other: *common-opts
  tasks:
    - checkout:
        path: op_worker
        force-clean-build: 'true'
        description: Checkout Default Repository
    - script: &run-script
        interpreter: SHELL
        scripts:
          - |-
            #!/bin/bash
            if [[ ${bamboo_planRepository_branch} != "develop" && ! ${bamboo_planRepository_branch} =~ ^release/.* ]]; then
              if [ -z ${bamboo_ManualBuildTriggerReason_userName+x} ]; then
                echo "===========================================================================================================" >&2
                echo "CAUTION: This branch (${bamboo_planRepository_branch}) should be run manually!" >&2
                echo "Builds triggered automatically by changes in the repo will always fail." >&2
                echo "===========================================================================================================" >&2
                exit 1;
              fi
            fi
        description: Trigger check
        conditions:
          - variable:
              matches:
                bamboo.buildNumber: '[4-9]|.{2,}'
    - script:
        <<: *run-script
        scripts:
          - |-
            cd op_worker
            git remote set-url origin ${bamboo.repository.git.repositoryUrl}
            git remote -v
            make submodules
            cd ..
        description: Init submodules
    - script:
        <<: *run-script
        scripts:
          - find . -type f -exec sed -i 's/plgrid.pl/onedata.org/g' {} \;
        description: substitute plgrid.pl with onedata.org
    - script:
        <<: *run-script
        scripts:
          - ./make.py -e REBAR_PROFILE=bamboo -r ${bamboo.agentWorkingDirectory} test_rel
        environment: PREFER_STATIC_LINK=1
        working-dir: op_worker
        description: Build
    - script:
        <<: *run-script
        scripts:
          - tar -czf op_worker.tar.gz op_worker/
        description: Package
        conditions:
          - variable:
              matches:
                bamboo.buildNumber: '.{1,}'
    - script:
        <<: *run-script
        scripts:
          - |-
            echo ./op_worker/bamboos/artifacts/push_artifact.py --hostname ${bamboo.artifactRepoHostname} --port ${bamboo.artifactRepoPort} \
                --username ${bamboo.artifactRepoUsername} --branch ${bamboo.planRepository.branchName} --plan ${bamboo.planRepository.name} \
                --artifact-name op_worker.tar.gz
            ./op_worker/bamboos/artifacts/push_artifact.py --hostname ${bamboo.artifactRepoHostname} --port ${bamboo.artifactRepoPort} \
                --username ${bamboo.artifactRepoUsername} --branch ${bamboo.planRepository.branchName} --plan ${bamboo.planRepository.name} \
                --artifact-name op_worker.tar.gz
        description: Push artifact
  final-tasks:
    - script: &clear-env
        <<: *run-script
        scripts:
          - curl ${bamboo.OnedataFinalTasksURL} | bash -
        description: Clear env
  artifacts:
    - name: op_worker.tar.gz
      pattern: op_worker.tar.gz
      shared: true
      required: false
  requirements: &requirements
    - system.docker.executable
    - onedata
  artifact-subscriptions: [ ]

_Codetag Tracker:
  key: CT
  tasks:
    - checkout: &fake-checkout
        conditions:
          - variable:
              exists: fake.var
    - script: &unpack
        <<: *run-script
        scripts:
          - tar -xzmf op_worker.tar.gz
        description: Unpack
    - script: &run-script-working-dir
        <<: *run-script
        scripts:
          - ./make.py -r ${bamboo.agentWorkingDirectory} codetag-tracker BRANCH=${bamboo.planRepository.branchName}
        working-dir: op_worker
        description: Codetag Tracker
  final-tasks:
    - test-parser: &parse-test-results
        type: junit
        ignore-time: 'false'
        test-results: op_worker/test/codetag_tracker_results/TEST-*.xml
        description: Parse test results
    - script: *clear-env
  requirements: *requirements
  artifact-subscriptions: &op-worker
    - artifact: op_worker.tar.gz

_Dialyze:
  key: DIAL
  other: *common-opts
  tasks:
    - checkout: *fake-checkout
    - script: *unpack
    - script:
        <<: *run-script-working-dir
        scripts:
          - ./make.py --cpuset-cpus 0 dialyzer
        description: Dialyze
  final-tasks:
    - test-parser:
        <<: *parse-test-results
        test-results: op_worker/test/dialyzer_results/TEST-*.xml
    - script:
        <<: *run-script
        scripts:
          - |
            rm op_worker.tar.gz
            find op_worker/ -maxdepth 1 -not -name '.dialyzer.plt' -not -path 'op_worker/' -exec rm -rf '{}' +
        description: Cleanup
    - script: *clear-env
  requirements: *requirements
  artifact-subscriptions: *op-worker

_Unit Test:
  key: UNIT
  other: *common-opts
  tasks:
    - checkout: *fake-checkout
    - script: *unpack
    - script:
        <<: *run-script-working-dir
        scripts:
          - |-
            if bamboos/scripts/should-skip-coverage.sh; then
                echo "Running eunit tests without coverage..."
                ./make.py -r ${bamboo.agentWorkingDirectory} eunit
            else
                echo "Running eunit tests with coverage..."
                ./make.py -r ${bamboo.agentWorkingDirectory} eunit-with-cover
            fi
        description: Run EUnit
    - script:
        <<: *run-script
        scripts:
          - |-
            tar -xzmf op_worker.tar.gz
            cd op_worker
            make submodules
            ARTIFACT="eunit.tar.gz"
            echo ./bamboos/artifacts/pull_artifact.py --hostname ${bamboo.artifactRepoHostname} --port ${bamboo.artifactRepoPort} \
                --username ${bamboo.artifactRepoUsername} --branch ${bamboo.branchSrc} --plan ${bamboo.planRepository.name} \
                --artifact-name ${ARTIFACT}
            ./bamboos/artifacts/pull_artifact.py --hostname ${bamboo.artifactRepoHostname} --port ${bamboo.artifactRepoPort} \
                --username ${bamboo.artifactRepoUsername} --branch ${bamboo.branchSrc} --plan ${bamboo.planRepository.name} \
                --artifact-name ${ARTIFACT}
            tar zxf ${ARTIFACT}
            touch test/eunit_results/TEST-*.xml
        description: Pull eunit artifact and unpack it
        conditions: &quarantine-hack-cond-build2-3
          - variable:
              matches:
                bamboo.buildNumber: '2|3'
  final-tasks:
    - script:
        <<: *run-script-working-dir
        scripts:
          - |-
            mkdir -p cover_eunit
            cp -r _build/test/cover/* cover_eunit
            tar -czf cover_eunit.tar.gz cover_eunit/
        description: Save cover and test results
    - test-parser:
        <<: *parse-test-results
        test-results: op_worker/test/eunit_results/TEST-*.xml
        description: Parse test results
    - script:
        <<: *run-script-working-dir
        scripts:
          - |-
            ARTIFACT=eunit.tar.gz
            tar czf ${ARTIFACT} test/eunit_results/TEST-*.xml
            echo ./bamboos/artifacts/push_artifact.py --hostname ${bamboo.artifactRepoHostname} --port ${bamboo.artifactRepoPort} \
                --username ${bamboo.artifactRepoUsername} --branch ${bamboo.planRepository.branchName} --plan ${bamboo.planRepository.name} \
                --artifact-name ${ARTIFACT}
            ./bamboos/artifacts/push_artifact.py --hostname ${bamboo.artifactRepoHostname} --port ${bamboo.artifactRepoPort} \
                --username ${bamboo.artifactRepoUsername} --branch ${bamboo.planRepository.branchName} --plan ${bamboo.planRepository.name} \
                --artifact-name ${ARTIFACT}
        description: Pack and push eunit artifact
    - script: *clear-env
  artifacts:
    - name: cover_eunit.tar.gz
      location: op_worker
      pattern: cover_eunit.tar.gz
      shared: true
      required: false
  requirements: *requirements
  artifact-subscriptions: *op-worker

api_file_attrs: &ct-onenv-job
  key: APIARC
  other: *common-opts
  tasks:
    - checkout: *fake-checkout
    - script: *clear-env
    - script:
        <<: *run-script
        scripts:
          - sudo ${HOME}/restart_minikube.sh
        description: Restart minikube
    - script: &quarantine-hack-pull-surefire
        <<: *run-script
        scripts:
          - |-
            tar -xzmf op_worker.tar.gz
            cd op_worker
            make submodules
            ARTIFACT="surefire_${bamboo_shortJobName}.tar.gz"
            echo ./bamboos/artifacts/pull_artifact.py --hostname ${bamboo.artifactRepoHostname} --port ${bamboo.artifactRepoPort} \
                --username ${bamboo.artifactRepoUsername} --branch ${bamboo.branchSrc} --plan ${bamboo.planRepository.name} \
                --artifact-name surefire_${bamboo.shortJobName}.tar.gz
            ./bamboos/artifacts/pull_artifact.py --hostname ${bamboo.artifactRepoHostname} --port ${bamboo.artifactRepoPort} \
                --username ${bamboo.artifactRepoUsername} --branch ${bamboo.branchSrc} --plan ${bamboo.planRepository.name} \
                --artifact-name ${ARTIFACT}
            tar zxf ${ARTIFACT}
            touch test_distributed/logs/*/surefire.xml
        description: Pull surefire artifact and unpack it
        conditions: *quarantine-hack-cond-build2-3
    - script: *unpack
    - script:
        <<: *run-script-working-dir
        scripts:
          - one-env/onenv pull_artifacts --hostname ${bamboo.artifactRepoHostname} --port ${bamboo.artifactRepoPort} --path .. branchConfig.yaml
        description: Download artifacts
    - script:
        <<: *run-script-working-dir
        scripts:
          - ./ct_onenv.py --suite ${bamboo.shortJobName} --path-to-sources ..
        description: Run CT onenv tests
  final-tasks: &final-tasks
    - test-parser:
        <<: *parse-test-results
        test-results: op_worker/test_distributed/logs/*/surefire.xml
    - script:
        <<: *run-script-working-dir
        scripts:
          - |-
            mkdir -p cover_ct
            cp test_distributed/logs/ct_run.*/*cover* cover_ct
            cp test_distributed/logs/ct_run.*/*COVER* cover_ct
            tar -czf cover_ct_${bamboo.shortJobName}.tar.gz cover_ct/
        description: Save cover and test results
    - script:
        <<: *run-script-working-dir
        scripts:
          - |-
            tar czf surefire_${bamboo.shortJobName}.tar.gz test_distributed/logs/*/surefire.xml
            echo ./bamboos/artifacts/push_artifact.py --hostname ${bamboo.artifactRepoHostname} --port ${bamboo.artifactRepoPort} \
                --username ${bamboo.artifactRepoUsername} --branch ${bamboo.planRepository.branchName} --plan ${bamboo.planRepository.name} \
                --artifact-name surefire_${bamboo.shortJobName}.tar.gz
            ./bamboos/artifacts/push_artifact.py --hostname ${bamboo.artifactRepoHostname} --port ${bamboo.artifactRepoPort} \
                --username ${bamboo.artifactRepoUsername} --branch ${bamboo.planRepository.branchName} --plan ${bamboo.planRepository.name} \
                --artifact-name surefire_${bamboo.shortJobName}.tar.gz
        description: Pack and push surefire artifact
    - script:
        <<: *run-script
        interpreter: BINSH_OR_CMDEXE
        scripts:
          - tar -mczf ct_logs_${bamboo.shortJobName}.tar.gz op_worker/test_distributed/logs/
        description: Pack test logs
    - script: *clear-env
  artifacts:
    - &cover_ct
      name: cover_ct_api_file_attrs.tar.gz
      pattern: cover_ct_${bamboo.shortJobName}.tar.gz
      location: op_worker
      shared: true
      required: false
    - &ct_logs
      name: ct_logs_${bamboo.shortJobName}.tar.gz
      pattern: ct_logs_${bamboo.shortJobName}.tar.gz
      shared: false
      required: false
  requirements:
    - minikube
  artifact-subscriptions: *op-worker

api_file_crud:
  <<: *ct-onenv-job
  key: FILCRUDAPI
  artifacts:
    - <<: *cover_ct
      name: cover_ct_api_file_crud.tar.gz
    - *ct_logs

api_file_ls:
  <<: *ct-onenv-job
  key: FILLSAPI
  artifacts:
    - <<: *cover_ct
      name: cover_ct_api_file_ls.tar.gz
    - *ct_logs

api_file_metadata_delete:
  <<: *ct-onenv-job
  key: FILMETRMAPI
  artifacts:
    - <<: *cover_ct
      name: cover_ct_api_file_metadata_delete.tar.gz
    - *ct_logs

api_file_metadata_get:
  <<: *ct-onenv-job
  key: FILMDAPI
  artifacts:
    - <<: *cover_ct
      name: cover_ct_api_file_metadata_get.tar.gz
    - *ct_logs

api_file_metadata_set:
  <<: *ct-onenv-job
  key: FILMETSETAPI
  artifacts:
    - <<: *cover_ct
      name: cover_ct_api_file_metadata_set.tar.gz
    - *ct_logs

api_file_stream:
  <<: *ct-onenv-job
  key: FILSTREAMAPI
  artifacts:
    - <<: *cover_ct
      name: cover_ct_api_file_stream.tar.gz
    - *ct_logs

api_file_upload:
  <<: *ct-onenv-job
  key: FILUPLOADAPI
  artifacts:
    - <<: *cover_ct
      name: cover_ct_api_file_upload.tar.gz
    - *ct_logs

api_share:
  <<: *ct-onenv-job
  key: SHARAPI
  artifacts:
    - <<: *cover_ct
      name: cover_ct_api_share.tar.gz
    - *ct_logs

autocleaning: &ct-job
  key: AUT
  other: *common-opts
  tasks:
    - checkout: *fake-checkout
    - script: *unpack
    - script: *quarantine-hack-pull-surefire
    - script:
        <<: *run-script-working-dir
        scripts:
          - ./ct_run.py --suite ${bamboo.shortJobName}
        description: Run CT
  final-tasks: *final-tasks
  artifacts:
    - <<: *cover_ct
      name: cover_ct_autocleaning.tar.gz
    - *ct_logs
  requirements: *requirements
  artifact-subscriptions: *op-worker

cdmi:
  <<: *ct-job
  key: CDMI
  artifacts:
    - <<: *cover_ct
      name: cover_ct_cdmi.tar.gz
    - *ct_logs

ceph_helper:
  <<: *ct-job
  key: CE
  artifacts:
    - <<: *cover_ct
      name: cover_ct_ceph_helper.tar.gz
    - *ct_logs

cephrados_helper:
  <<: *ct-job
  key: CEP
  description: CephRados helper integration test
  artifacts:
    - <<: *cover_ct
      name: cover_ct_cephrados_helper.tar.gz
    - *ct_logs

client_events:
  <<: *ct-job
  key: CLIEVE
  artifacts:
    - <<: *cover_ct
      name: cover_ct_client_events.tar.gz
    - *ct_logs

cluster_upgrade:
  <<: *ct-job
  key: CLUS
  artifacts:
    - <<: *cover_ct
      name: cover_ct_cluster_upgrade.tar.gz
    - *ct_logs

connection:
  <<: *ct-job
  key: CON
  artifacts:
    - <<: *cover_ct
      name: cover_ct_connection.tar.gz
    - *ct_logs

connection_layer:
  <<: *ct-job
  key: CONLAYER
  artifacts:
    - <<: *cover_ct
      name: cover_ct_connection_layer.tar.gz
    - *ct_logs

connection_manager:
  <<: *ct-onenv-job
  key: CONMANAGER
  artifacts:
    - <<: *cover_ct
      name: cover_ct_connection_manager.tar.gz
    - *ct_logs

datastore_remote_driver:
  <<: *ct-job
  key: DRD
  artifacts:
    - <<: *cover_ct
      name: cover_ct_datastore_remote_driver.tar.gz
    - *ct_logs

dbsync:
  <<: *ct-job
  key: DBSYN
  artifacts:
    - <<: *cover_ct
      name: cover_ct_dbsync.tar.gz
    - *ct_logs

dbsync_changes_requesting:
  <<: *ct-job
  key: DCR
  artifacts:
    - <<: *cover_ct
      name: cover_ct_dbsync_changes_requesting.tar.gz
    - *ct_logs
  requirements: &os-agent
    - os-agent
    - system.docker.executable
    - onedata

dbsync_changes_requesting_with_errors:
  <<: *ct-job
  key: DCRWE
  artifacts:
    - <<: *cover_ct
      name: cover_ct_dbsync_changes_requesting_with_errors.tar.gz
    - *ct_logs
  requirements: *os-agent

event_manager:
  <<: *ct-job
  key: EVMG
  artifacts:
    - <<: *cover_ct
      name: cover_ct_event_manager.tar.gz
    - *ct_logs

event_stream:
  <<: *ct-job
  key: EVSTR
  artifacts:
    - <<: *cover_ct
      name: cover_ct_event_stream.tar.gz
    - *ct_logs

events:
  <<: *ct-job
  key: EV
  artifacts:
    - <<: *cover_ct
      name: cover_ct_events.tar.gz
    - *ct_logs

events_performance:
  <<: *ct-job
  key: EVPERF
  artifacts:
    - <<: *cover_ct
      name: cover_ct_events_performance.tar.gz
    - *ct_logs

events_reliability:
  <<: *ct-job
  key: EVREL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_events_reliability.tar.gz
    - *ct_logs

events_reliability_2op:
  <<: *ct-job
  key: EVREL2OP
  artifacts:
    - <<: *cover_ct
      name: cover_ct_events_reliability_2op.tar.gz
    - *ct_logs

file_deletion:
  <<: *ct-job
  key: FILEDEL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_file_deletion.tar.gz
    - *ct_logs

file_lifecycle:
  <<: *ct-job
  key: FIL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_file_lifecycle.tar.gz
    - *ct_logs

file_links_reconciliation_traverse:
  <<: *ct-onenv-job
  key: FLRECTR
  artifacts:
    - <<: *cover_ct
      name: cover_ct_file_links_reconciliation_traverse.tar.gz
    - *ct_logs
  requirements: *os-agent

file_popularity:
  <<: *ct-job
  key: FPOP
  artifacts:
    - <<: *cover_ct
      name: cover_ct_file_popularity.tar.gz
    - *ct_logs

file_registration:
  <<: *ct-job
  key: FILREG
  artifacts:
    - <<: *cover_ct
      name: cover_ct_file_registration.tar.gz
    - *ct_logs

fslogic_req:
  <<: *ct-job
  key: FSLOG
  artifacts:
    - <<: *cover_ct
      name: cover_ct_fslogic_req.tar.gz
    - *ct_logs

glusterfs_helper:
  <<: *ct-job
  key: GLUS
  description: GlusterFS helper test
  artifacts:
    - <<: *cover_ct
      name: cover_ct_glusterfs_helper.tar.gz
    - *ct_logs

gs_channel:
  <<: *ct-job
  key: GSCHAN
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_channel.tar.gz
    - *ct_logs

gs_cluster_logic:
  <<: *ct-job
  key: CL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_cluster_logic.tar.gz
    - *ct_logs

gs_group_logic:
  <<: *ct-job
  key: GROUP
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_group_logic.tar.gz
    - *ct_logs

gs_handle_logic:
  <<: *ct-job
  key: HAN
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_handle_logic.tar.gz
    - *ct_logs

gs_handle_service_logic:
  <<: *ct-job
  key: HSL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_handle_service_logic.tar.gz
    - *ct_logs

gs_harvester_logic:
  <<: *ct-job
  key: HARLOG
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_harvester_logic.tar.gz
    - *ct_logs

gs_provider_logic:
  <<: *ct-job
  key: PROV
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_provider_logic.tar.gz
    - *ct_logs

gs_share_logic:
  <<: *ct-job
  key: SHAR
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_share_logic.tar.gz
    - *ct_logs

gs_space_logic:
  <<: *ct-job
  key: SPAC
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_space_logic.tar.gz
    - *ct_logs

gs_storage_logic:
  <<: *ct-job
  key: STLO
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_storage_logic.tar.gz
    - *ct_logs

gs_token_logic:
  <<: *ct-job
  key: TOK
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_token_logic.tar.gz
    - *ct_logs

gs_user_logic:
  <<: *ct-job
  key: US
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_user_logic.tar.gz
    - *ct_logs

gs_zone_connection:
  <<: *ct-onenv-job
  key: ZON
  artifacts:
    - <<: *cover_ct
      name: cover_ct_gs_zone_connection.tar.gz
    - *ct_logs
  requirements: *os-agent

harvesting:
  <<: *ct-job
  key: HAR
  artifacts:
    - <<: *cover_ct
      name: cover_ct_harvesting.tar.gz
    - *ct_logs

harvesting_stream:
  <<: *ct-job
  key: HARMNG
  artifacts:
    - <<: *cover_ct
      name: cover_ct_harvesting_stream.tar.gz
    - *ct_logs
  requirements: *os-agent

idp_access_token:
  <<: *ct-job
  key: IAT
  artifacts:
    - <<: *cover_ct
      name: cover_ct_idp_access_token.tar.gz
    - *ct_logs

lfm_attrs:
  <<: *ct-job
  key: LFMATTR
  artifacts:
    - <<: *cover_ct
      name: cover_ct_lfm_attrs.tar.gz
    - *ct_logs

lfm_files_posix:
  <<: *ct-job
  key: LFMFIL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_lfm_files_posix.tar.gz
    - *ct_logs

lfm_files_s3:
  <<: *ct-job
  key: LFMFS3
  artifacts:
    - <<: *cover_ct
      name: cover_ct_lfm_files_s3.tar.gz
    - *ct_logs

luma:
  <<: *ct-job
  key: LUMA
  artifacts:
    - <<: *cover_ct
      name: cover_ct_luma.tar.gz
    - *ct_logs

massive_multi_provider_file_ops2:
  <<: *ct-job
  key: MAS2
  artifacts:
    - <<: *cover_ct
      name: cover_ct_massive_multi_provider_file_ops2.tar.gz
    - *ct_logs
  requirements: *os-agent

massive_multi_provider_file_ops:
  <<: *ct-job
  key: MAS
  artifacts:
    - <<: *cover_ct
      name: cover_ct_massive_multi_provider_file_ops.tar.gz
    - *ct_logs
  requirements: *os-agent

memory_pools_cleanup:
  <<: *ct-job
  key: MEM
  artifacts:
    - <<: *cover_ct
      name: cover_ct_memory_pools_cleanup.tar.gz
    - *ct_logs

model_file_meta:
  <<: *ct-job
  key: MO
  artifacts:
    - <<: *cover_ct
      name: cover_ct_model_file_meta.tar.gz
    - *ct_logs

monitoring:
  <<: *ct-job
  key: MON
  artifacts:
    - <<: *cover_ct
      name: cover_ct_monitoring.tar.gz
    - *ct_logs

multi_provider_cdmi:
  <<: *ct-job
  key: MULTIPROVCDMI
  artifacts:
    - <<: *cover_ct
      name: cover_ct_multi_provider_cdmi.tar.gz
    - *ct_logs

multi_provider_changes_rest:
  <<: *ct-job
  key: MUL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_multi_provider_changes_rest.tar.gz
    - *ct_logs

multi_provider_db_sync:
  <<: *ct-job
  key: MULPDBS
  artifacts:
    - <<: *cover_ct
      name: cover_ct_multi_provider_db_sync.tar.gz
    - *ct_logs
  requirements: *os-agent

multi_provider_file_ops:
  <<: *ct-job
  key: MULTIFOPS
  artifacts:
    - <<: *cover_ct
      name: cover_ct_multi_provider_file_ops.tar.gz
    - *ct_logs
  requirements: *os-agent

multi_provider_proxy:
  <<: *ct-job
  key: MULPPROX
  artifacts:
    - <<: *cover_ct
      name: cover_ct_multi_provider_proxy.tar.gz
    - *ct_logs
  requirements: *os-agent

multi_provider_qos:
  <<: *ct-job
  key: MULPQOS
  artifacts:
    - <<: *cover_ct
      name: cover_ct_multi_provider_qos.tar.gz
    - *ct_logs
  requirements: *os-agent

multi_provider_rest:
  <<: *ct-job
  key: MULREST
  artifacts:
    - <<: *cover_ct
      name: cover_ct_multi_provider_rest.tar.gz
    - *ct_logs

multi_provider_view_rest:
  <<: *ct-job
  key: MULIDX
  artifacts:
    - <<: *cover_ct
      name: cover_ct_multi_provider_view_rest.tar.gz
    - *ct_logs
  requirements: *os-agent

node_failure:
  <<: *ct-onenv-job
  key: NOD
  artifacts:
    - <<: *cover_ct
      name: cover_ct_node_failure.tar.gz
    - *ct_logs
  requirements: *os-agent

nulldevice_helper:
  <<: *ct-job
  key: NUL
  description: Null Device helper integration test
  artifacts:
    - <<: *cover_ct
      name: cover_ct_nulldevice_helper.tar.gz
    - *ct_logs

performance_2_provider:
  <<: *ct-job
  key: P2P
  artifacts:
    - <<: *cover_ct
      name: cover_ct_performance_2_provider.tar.gz
    - *ct_logs

permissions_posix:
  <<: *ct-job
  key: PERMPOSIX
  artifacts:
    - <<: *cover_ct
      name: cover_ct_permissions_posix.tar.gz
    - *ct_logs
  requirements: *os-agent

permissions_s3:
  <<: *ct-job
  key: PERMS3
  artifacts:
    - <<: *cover_ct
      name: cover_ct_permissions_s3.tar.gz
    - *ct_logs
  requirements: *os-agent

posix_helper:
  <<: *ct-job
  key: HELP
  artifacts:
    - <<: *cover_ct
      name: cover_ct_posix_helper.tar.gz
    - *ct_logs

provider_connection:
  <<: *ct-job
  key: PROVCON
  artifacts:
    - <<: *cover_ct
      name: cover_ct_provider_connection.tar.gz
    - *ct_logs

qos:
  <<: *ct-job
  key: QOS
  artifacts:
    - <<: *cover_ct
      name: cover_ct_qos.tar.gz
    - *ct_logs

qos_api:
  <<: *ct-job
  key: QOSAPI
  artifacts:
    - <<: *cover_ct
      name: cover_ct_qos_api.tar.gz
    - *ct_logs

qos_replica_protection:
  <<: *ct-job
  key: QRP
  artifacts:
    - <<: *cover_ct
      name: cover_ct_qos_replica_protection.tar.gz
    - *ct_logs

quota:
  <<: *ct-job
  key: QU
  artifacts:
    - <<: *cover_ct
      name: cover_ct_quota.tar.gz
    - *ct_logs

readonly_storage:
  <<: *ct-job
  key: ROST
  artifacts:
    - <<: *cover_ct
      name: cover_ct_readonly_storage.tar.gz
    - *ct_logs

rename:
  <<: *ct-job
  key: RE
  artifacts:
    - <<: *cover_ct
      name: cover_ct_rename.tar.gz
    - *ct_logs

replica_deletion:
  <<: *ct-job
  key: REPDEL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_replica_deletion.tar.gz
    - *ct_logs

replica_eviction_transfers_rest:
  <<: *ct-job
  key: REPEVREST
  artifacts:
    - <<: *cover_ct
      name: cover_ct_replica_eviction_transfers_rest.tar.gz
    - *ct_logs

replica_migration_transfers_rest:
  <<: *ct-job
  key: REPMIGREST
  artifacts:
    - <<: *cover_ct
      name: cover_ct_replica_migration_transfers_rest.tar.gz
    - *ct_logs

replication:
  <<: *ct-job
  key: REP
  artifacts:
    - <<: *cover_ct
      name: cover_ct_replication.tar.gz
    - *ct_logs

replication_transfers_rest:
  <<: *ct-job
  key: REPREST
  artifacts:
    - <<: *cover_ct
      name: cover_ct_replication_transfers_rest.tar.gz
    - *ct_logs

rest:
  <<: *ct-job
  key: RES
  artifacts:
    - <<: *cover_ct
      name: cover_ct_rest.tar.gz
    - *ct_logs

reverse_luma:
  <<: *ct-job
  key: REV
  artifacts:
    - <<: *cover_ct
      name: cover_ct_reverse_luma.tar.gz
    - *ct_logs

s3_helper:
  <<: *ct-job
  key: S3HEL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_s3_helper.tar.gz
    - *ct_logs

sequencer:
  <<: *ct-job
  key: SEQ
  artifacts:
    - <<: *cover_ct
      name: cover_ct_sequencer.tar.gz
    - *ct_logs

sequencer_in_stream:
  <<: *ct-job
  key: SEQINSTR
  artifacts:
    - <<: *cover_ct
      name: cover_ct_sequencer_in_stream.tar.gz
    - *ct_logs

sequencer_manager:
  <<: *ct-job
  key: SEQMG
  artifacts:
    - <<: *cover_ct
      name: cover_ct_sequencer_manager.tar.gz
    - *ct_logs

sequencer_out_stream:
  <<: *ct-job
  key: SEQOUTSTR
  artifacts:
    - <<: *cover_ct
      name: cover_ct_sequencer_out_stream.tar.gz
    - *ct_logs

sequencer_performance:
  <<: *ct-job
  key: SEQPERF
  artifacts:
    - <<: *cover_ct
      name: cover_ct_sequencer_performance.tar.gz
    - *ct_logs

session_manager:
  <<: *ct-job
  key: SESMG
  artifacts:
    - <<: *cover_ct
      name: cover_ct_session_manager.tar.gz
    - *ct_logs

session_offline:
  <<: *ct-onenv-job
  key: SESSOFFLINE
  artifacts:
    - <<: *cover_ct
      name: cover_ct_session_offline.tar.gz
    - *ct_logs

session_watcher:
  <<: *ct-job
  key: SESWTCH
  artifacts:
    - <<: *cover_ct
      name: cover_ct_session_watcher.tar.gz
    - *ct_logs

single_node_failure:
  <<: *ct-onenv-job
  key: SNF
  artifacts:
    - <<: *cover_ct
      name: cover_ct_single_node_failure.tar.gz
    - *ct_logs

space_unsupport:
  <<: *ct-job
  key: SPUN
  artifacts:
    - <<: *cover_ct
      name: cover_ct_space_unsupport.tar.gz
    - *ct_logs

storage_cleanup:
  <<: *ct-job
  key: STCL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_storage_cleanup.tar.gz
    - *ct_logs

storage_files:
  <<: *ct-job
  key: STFILES
  artifacts:
    - <<: *cover_ct
      name: cover_ct_storage_files.tar.gz
    - *ct_logs

storage_import:
  <<: *ct-job
  key: STORIMP
  artifacts:
    - <<: *cover_ct
      name: cover_ct_storage_import.tar.gz
    - *ct_logs

storage_import_deletion:
  <<: *ct-job
  key: STORIMPDEL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_storage_import_deletion.tar.gz
    - *ct_logs

storage_import_s3:
  <<: *ct-job
  key: STORIMPS3
  artifacts:
    - <<: *cover_ct
      name: cover_ct_storage_import_s3.tar.gz
    - *ct_logs

storage_req:
  <<: *ct-job
  key: FUS
  artifacts:
    - <<: *cover_ct
      name: cover_ct_storage_req.tar.gz
    - *ct_logs

storage_sync_links:
  <<: *ct-job
  key: SSL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_storage_sync_links.tar.gz
    - *ct_logs

storage_traverse:
  <<: *ct-job
  key: STTR
  artifacts:
    - <<: *cover_ct
      name: cover_ct_storage_traverse.tar.gz
    - *ct_logs

swift_helper:
  <<: *ct-job
  key: SWIHEL
  artifacts:
    - <<: *cover_ct
      name: cover_ct_swift_helper.tar.gz
    - *ct_logs

tmp_db_error:
  <<: *ct-onenv-job
  key: TMPDBER
  artifacts:
    - <<: *cover_ct
      name: cover_ct_tmp_db_error.tar.gz
    - *ct_logs

transfer_create_api:
  <<: *ct-job
  key: TRANCREATE
  artifacts:
    - <<: *cover_ct
      name: cover_ct_transfer_create_api.tar.gz
    - *ct_logs

transfer_get_api:
  <<: *ct-job
  key: TRANGETAPI
  artifacts:
    - <<: *cover_ct
      name: cover_ct_transfer_get_api.tar.gz
    - *ct_logs

transfer_stats:
  <<: *ct-job
  key: TRAN
  artifacts:
    - <<: *cover_ct
      name: cover_ct_transfer_stats.tar.gz
    - *ct_logs

transfers_restart:
  <<: *ct-onenv-job
  key: TRRST
  artifacts:
    - <<: *cover_ct
      name: cover_ct_transfers_restart.tar.gz
    - *ct_logs

trash:
  <<: *ct-onenv-job
  key: TRASH
  artifacts:
    - <<: *cover_ct
      name: cover_ct_trash.tar.gz
    - *ct_logs

tree_deletion_traverse:
  <<: *ct-onenv-job
  key: TDT
  artifacts:
    - <<: *cover_ct
      name: cover_ct_tree_deletion_traverse.tar.gz
    - *ct_logs

user_auth:
  <<: *ct-job
  key: USERAUTH
  artifacts:
    - <<: *cover_ct
      name: cover_ct_user_auth.tar.gz
    - *ct_logs

view:
  <<: *ct-job
  key: INDEX
  artifacts:
    - <<: *cover_ct
      name: cover_ct_view.tar.gz
    - *ct_logs

webdav_helper:
  <<: *ct-job
  key: WEB
  artifacts:
    - <<: *cover_ct
      name: cover_ct_webdav_helper.tar.gz
    - *ct_logs

webdav_token:
  <<: *ct-job
  key: WDT
  artifacts:
    - <<: *cover_ct
      name: cover_ct_webdav_token.tar.gz
    - *ct_logs

xrootd_helper:
  <<: *ct-job
  key: XROOT
  description: Test XRootD helper
  artifacts:
    - <<: *cover_ct
      name: cover_ct_xrootd_helper.tar.gz
    - *ct_logs

Coverage report:
  key: CR
  other: *common-opts
  tasks:
    - checkout: *fake-checkout
  final-tasks:
    - script:
        <<: *run-script
        scripts:
          - |
            tar -xzmf op_worker.tar.gz
            if op_worker/bamboos/scripts/should-skip-coverage.sh; then
              echo "Skipping coverage report collection"
            else
              LOG_PATH=op_worker/test_distributed/logs
              tar -xzmf cover_eunit.tar.gz
              mkdir -p op_worker/_build/test/cover
              mv cover_eunit/* op_worker/_build/test/cover
              mkdir tmp
              for archive in $(ls ct_logs_*.tar.gz)
              do
                cp ${archive} tmp
                base=$(basename ${archive} .tar.gz)
                cd tmp
                tar -xzmf *.tar.gz
                LOG_DIR=$(ls -dt ${LOG_PATH}/ct_run* | head -1)
                echo $LOG_DIR
                cp -r ${LOG_DIR} ../${LOG_DIR}_${base}
                cd ..
                rm -rf tmp/*
              done
              rm -rf tmp
            fi
        description: Unpack
    - script:
        <<: *run-script-working-dir
        scripts:
          - |-
            if bamboos/scripts/should-skip-coverage.sh; then
                # generate some dummy artifact data so that the build can finish with success
                mkdir test_coverage
                echo "Test coverage was skipped. Run a custom build with coverOptionOverride set to true if you wish to collect a coverage report." > test_coverage/readme-coverage-skipped.txt
            else
                ./make.py on_bamboo=true coverage
            fi
        description: Generate coverage reports
    - script:
        <<: *run-script
        scripts:
          - tar -czf test_coverage.tar.gz op_worker/test_coverage
        description: Save coverage report
    - script: *clear-env
  artifacts:
    - name: test_coverage.tar.gz
      pattern: test_coverage.tar.gz
      shared: false
      required: false
  requirements: *requirements
  artifact-subscriptions:
    - artifact: cover_eunit.tar.gz
    - artifact: op_worker.tar.gz
    - artifact: cover_ct_api_file_attrs.tar.gz
    - artifact: cover_ct_api_file_crud.tar.gz
    - artifact: cover_ct_api_file_ls.tar.gz
    - artifact: cover_ct_api_file_metadata_delete.tar.gz
    - artifact: cover_ct_api_file_metadata_get.tar.gz
    - artifact: cover_ct_api_file_metadata_set.tar.gz
    - artifact: cover_ct_api_file_stream.tar.gz
    - artifact: cover_ct_api_file_upload.tar.gz
    - artifact: cover_ct_api_share.tar.gz
    - artifact: cover_ct_autocleaning.tar.gz
    - artifact: cover_ct_cdmi.tar.gz
    - artifact: cover_ct_ceph_helper.tar.gz
    - artifact: cover_ct_cephrados_helper.tar.gz
    - artifact: cover_ct_client_events.tar.gz
    - artifact: cover_ct_cluster_upgrade.tar.gz
    - artifact: cover_ct_connection.tar.gz
    - artifact: cover_ct_connection_layer.tar.gz
    - artifact: cover_ct_connection_manager.tar.gz
    - artifact: cover_ct_datastore_remote_driver.tar.gz
    - artifact: cover_ct_dbsync.tar.gz
    - artifact: cover_ct_dbsync_changes_requesting.tar.gz
    - artifact: cover_ct_dbsync_changes_requesting_with_errors.tar.gz
    - artifact: cover_ct_event_manager.tar.gz
    - artifact: cover_ct_event_stream.tar.gz
    - artifact: cover_ct_events.tar.gz
    - artifact: cover_ct_events_performance.tar.gz
    - artifact: cover_ct_events_reliability.tar.gz
    - artifact: cover_ct_events_reliability_2op.tar.gz
    - artifact: cover_ct_file_deletion.tar.gz
    - artifact: cover_ct_file_lifecycle.tar.gz
    - artifact: cover_ct_file_links_reconciliation_traverse.tar.gz
    - artifact: cover_ct_file_popularity.tar.gz
    - artifact: cover_ct_file_registration.tar.gz
    - artifact: cover_ct_fslogic_req.tar.gz
    - artifact: cover_ct_glusterfs_helper.tar.gz
    - artifact: cover_ct_gs_channel.tar.gz
    - artifact: cover_ct_gs_cluster_logic.tar.gz
    - artifact: cover_ct_gs_group_logic.tar.gz
    - artifact: cover_ct_gs_handle_logic.tar.gz
    - artifact: cover_ct_gs_handle_service_logic.tar.gz
    - artifact: cover_ct_gs_harvester_logic.tar.gz
    - artifact: cover_ct_gs_provider_logic.tar.gz
    - artifact: cover_ct_gs_share_logic.tar.gz
    - artifact: cover_ct_gs_space_logic.tar.gz
    - artifact: cover_ct_gs_storage_logic.tar.gz
    - artifact: cover_ct_gs_token_logic.tar.gz
    - artifact: cover_ct_gs_user_logic.tar.gz
    - artifact: cover_ct_gs_zone_connection.tar.gz
    - artifact: cover_ct_harvesting.tar.gz
    - artifact: cover_ct_harvesting_stream.tar.gz
    - artifact: cover_ct_idp_access_token.tar.gz
    - artifact: cover_ct_lfm_attrs.tar.gz
    - artifact: cover_ct_lfm_files_posix.tar.gz
    - artifact: cover_ct_lfm_files_s3.tar.gz
    - artifact: cover_ct_luma.tar.gz
    - artifact: cover_ct_massive_multi_provider_file_ops.tar.gz
    - artifact: cover_ct_massive_multi_provider_file_ops2.tar.gz
    - artifact: cover_ct_memory_pools_cleanup.tar.gz
    - artifact: cover_ct_model_file_meta.tar.gz
    - artifact: cover_ct_monitoring.tar.gz
    - artifact: cover_ct_multi_provider_cdmi.tar.gz
    - artifact: cover_ct_multi_provider_changes_rest.tar.gz
    - artifact: cover_ct_multi_provider_db_sync.tar.gz
    - artifact: cover_ct_multi_provider_file_ops.tar.gz
    - artifact: cover_ct_multi_provider_proxy.tar.gz
    - artifact: cover_ct_multi_provider_qos.tar.gz
    - artifact: cover_ct_multi_provider_rest.tar.gz
    - artifact: cover_ct_multi_provider_view_rest.tar.gz
    - artifact: cover_ct_node_failure.tar.gz
    - artifact: cover_ct_nulldevice_helper.tar.gz
    - artifact: cover_ct_performance_2_provider.tar.gz
    - artifact: cover_ct_permissions_posix.tar.gz
    - artifact: cover_ct_permissions_s3.tar.gz
    - artifact: cover_ct_posix_helper.tar.gz
    - artifact: cover_ct_provider_connection.tar.gz
    - artifact: cover_ct_qos.tar.gz
    - artifact: cover_ct_qos_api.tar.gz
    - artifact: cover_ct_qos_replica_protection.tar.gz
    - artifact: cover_ct_quota.tar.gz
    - artifact: cover_ct_readonly_storage.tar.gz
    - artifact: cover_ct_rename.tar.gz
    - artifact: cover_ct_replica_deletion.tar.gz
    - artifact: cover_ct_replica_eviction_transfers_rest.tar.gz
    - artifact: cover_ct_replica_migration_transfers_rest.tar.gz
    - artifact: cover_ct_replication.tar.gz
    - artifact: cover_ct_replication_transfers_rest.tar.gz
    - artifact: cover_ct_rest.tar.gz
    - artifact: cover_ct_reverse_luma.tar.gz
    - artifact: cover_ct_s3_helper.tar.gz
    - artifact: cover_ct_sequencer.tar.gz
    - artifact: cover_ct_sequencer_in_stream.tar.gz
    - artifact: cover_ct_sequencer_manager.tar.gz
    - artifact: cover_ct_sequencer_out_stream.tar.gz
    - artifact: cover_ct_sequencer_performance.tar.gz
    - artifact: cover_ct_session_manager.tar.gz
    - artifact: cover_ct_session_offline.tar.gz
    - artifact: cover_ct_session_watcher.tar.gz
    - artifact: cover_ct_single_node_failure.tar.gz
    - artifact: cover_ct_space_unsupport.tar.gz
    - artifact: cover_ct_storage_cleanup.tar.gz
    - artifact: cover_ct_storage_files.tar.gz
    - artifact: cover_ct_storage_import.tar.gz
    - artifact: cover_ct_storage_import_deletion.tar.gz
    - artifact: cover_ct_storage_import_s3.tar.gz
    - artifact: cover_ct_storage_req.tar.gz
    - artifact: cover_ct_storage_sync_links.tar.gz
    - artifact: cover_ct_storage_traverse.tar.gz
    - artifact: cover_ct_swift_helper.tar.gz
    - artifact: cover_ct_tmp_db_error.tar.gz
    - artifact: cover_ct_transfer_create_api.tar.gz
    - artifact: cover_ct_transfer_get_api.tar.gz
    - artifact: cover_ct_transfer_stats.tar.gz
    - artifact: cover_ct_transfers_restart.tar.gz
    - artifact: cover_ct_trash.tar.gz
    - artifact: cover_ct_tree_deletion_traverse.tar.gz
    - artifact: cover_ct_user_auth.tar.gz
    - artifact: cover_ct_view.tar.gz
    - artifact: cover_ct_webdav_helper.tar.gz
    - artifact: cover_ct_webdav_token.tar.gz
    - artifact: cover_ct_xrootd_helper.tar.gz


Qnthack - rerun:
  key: ZREQN
  description: Rerun
  other: *common-opts
  tasks:
    - checkout: *fake-checkout
    - script:
        description: Rerun
        scripts:
          # The script which requests the next build of a plan resides on the bamboo server.
          # For more details about the script look at https://git.onedata.org/projects/VFS/repos/bamboos/browse/bamboo-server/run-build.sh?at=refs%2Fheads%2Ffeature%2FVFS-9519-auto-quarantine-test-cases-for-new-branches
          # The script is run indirectly by the CGI script used in the curl command.
          - curl 10.87.23.72:3080/cgi-bin/run-build?${bamboo_planKey}
        conditions:
          - variable:
              matches:
                bamboo.buildNumber: '2'
    - script: *always-successful
  artifact-subscriptions: [ ]
...
